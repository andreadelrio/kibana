<discover-app class="dscApp">
  <h1 class="euiScreenReaderOnly">{{screenTitle}}</h1>

  <!-- Local nav. -->
  <kbn-top-nav
    app-name="'discover'"
    config="topNavMenu"
    screen-title="screenTitle"
    show-search-bar="true"
    show-date-picker="enableTimeRangeSelector"
    index-patterns="[indexPattern]"
    query="state.query"
    on-query-submit="updateQuery"
    show-save-query="showSaveQuery"
    saved-query-id="state.savedQuery"
    on-saved-query-id-change="updateSavedQueryId"
    class="dscApp__header"
    use-default-behaviors="true"
  >
  </kbn-top-nav>

  <main class="dscApp__frame">
    <disc-field-chooser
      columns="state.columns"
      hits="rows"
      field-counts="fieldCounts"
      index-pattern="searchSource.getField('index')"
      index-pattern-list="opts.indexPatternList"
      state="state"
      on-add-field="addColumn"
      on-add-filter="filterQuery"
      on-remove-field="removeColumn"
      class="dscApp__sidebar"
      id="discover-sidebar"
    >
    </disc-field-chooser>

    <div class="dscApp__content">
      <discover-unsupported-index-pattern
        ng-if="isUnsupportedIndexPattern"
        unsupported-type="unsupportedIndexPatternType"
      ></discover-unsupported-index-pattern>

      <discover-no-results
        ng-show="resultState === 'none'"
        shard-failures="failures"
        time-field-name="opts.timefield"
        query-language="state.query.language"
        get-doc-link="getDocLink"
      ></discover-no-results>

      <discover-uninitialized
        ng-show="resultState === 'uninitialized'"
        on-refresh="fetch"
      ></discover-uninitialized>

      <!-- loading -->
      <div ng-show="resultState === 'loading'">
        <discover-fetch-error ng-show="fetchError" fetch-error="fetchError"></discover-fetch-error>

        <div ng-hide="fetchError" class="dscOverlay">
          <h2
            i18n-id="kbn.discover.searchingTitle"
            i18n-default-message="Searching"
            class="euiTitle euiTitle--small"
          ></h2>
          <div class="euiSpacer euiSpacer--m"></div>
          <div
            class="euiLoadingSpinner euiLoadingSpinner--large"
            data-test-subj="loadingSpinner"
          ></div>
        </div>
      </div>

      <div class="dscWrapper__content" ng-show="resultState === 'ready'">
        <!-- result -->
        <div class="dscResults">
          <button
            class="kuiButton kuiButton--basic kuiButton--iconText dscSkipButton"
            ng-click="showAllRows(); scrollToBottom()"
          >
            <span class="kuiButton__inner">
              <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-chevron-down"></span>
              <span
                i18n-id="kbn.discover.skipToBottomButtonLabel"
                i18n-default-message="Skip to bottom"
              ></span>
            </span>
          </button>

          <div class="dscResultCount">
            <div class="dscResuntCount__title">
              <h2 class="euiTitle euiTitle--xsmall " data-test-subj="discoverQueryHits">
                {{(hits || 0) | number:0}}
                <span
                  class="dscResultHits"
                  i18n-id="kbn.discover.resultsPluralTitle"
                  i18n-default-message="{results, plural, one {result} other {results}}"
                  i18n-values="{ results }"
                ></span>
              </h2>
            </div>
            <div class="dscResultCount__actions">
              <div class="euiText euiText--small">
                <button
                  ng-if="opts.savedSearch.id"
                  class="euiLink euiLink--primary eui-textNoWrap"
                  type="button"
                  id="reload_saved_search"
                  ng-click="resetQuery()"
                >
                  {{::'kbn.discover.reloadSavedSearchButton' | i18n: {defaultMessage: 'Reset
                  results'} }}
                </button>
              </div>
              <select
                id="dscResultsIntervalSelector"
                class="euiSelect euiSelect--compressed"
                ng-model="state.interval"
                ng-options="interval.val as interval.display for interval in intervalOptions | filter: intervalEnabled"
                ng-blur="toggleInterval()"
                data-test-subj="discoverIntervalSelect"
              >
              </select>
              <span ng-if="bucketInterval.scaled">
                <icon-tip content="getBucketIntervalToolTipText()" position="'top'"></icon-tip>
                <span
                  i18n-id="kbn.discover.scaledToDescription"
                  i18n-default-message="Scaled to {bucketIntervalDescription}"
                  i18n-values="{
                      bucketIntervalDescription: bucketInterval.description
                    }"
                ></span>
              </span>
            </div>
          </div>

          <section
            aria-label="{{::'kbn.discover.histogramOfFoundDocumentsAriaLabel' | i18n: {defaultMessage: 'Histogram of found documents'} }}"
            class="dscTimechart"
            ng-if="opts.timefield"
          >
            <discover-histogram
              class="dscHistogram"
              ng-show="vis && rows.length !== 0"
              chart-data="histogramData"
              timefilter-update-handler="timefilterUpdateHandler"
              watch-depth="reference"
              data-test-subj="discoverChart"
            ></discover-histogram>
          </section>

          <section class="dscTable" fixed-scroll aria-labelledby="documentsAriaLabel">
            <h2
              class="euiScreenReaderOnly"
              id="documentsAriaLabel"
              i18n-id="kbn.discover.documentsAriaLabel"
              i18n-default-message="Documents"
            ></h2>
            <discover-grid
              ng-if="rows && !useNewGrid"
              aria-labelled-by="'documentsAriaLabel'"
              columns="tableColumns"
              index-pattern="indexPattern"
              rows="rows"
              sort="state.sort"
              sample-size="opts.sampleSize"
              search-description="opts.savedSearch.description"
              search-title="opts.savedSearch.lastSavedTitle"
              use-short-dots="useShortDots"
              get-context-app-href="getContextAppHref"
              on-add-column="addColumn"
              on-filter="filterQuery"
              on-remove-column="removeColumn"
              on-sort="setSortOrder"
              class="dscDiscoverGrid"
            ></discover-grid>
            <div ng-if="useNewGrid">
              <doc-table
                hits="rows"
                index-pattern="indexPattern"
                sorting="state.sort"
                columns="state.columns"
                infinite-scroll="true"
                filter="filterQuery"
                filters="state.filters"
                data-shared-item
                data-title="{{opts.savedSearch.lastSavedTitle}}"
                data-description="{{opts.savedSearch.description}}"
                minimum-visible-rows="minimumVisibleRows"
                render-complete
                on-add-column="addColumn"
                on-change-sort-order="setSortOrder"
                on-move-column="moveColumn"
                on-remove-column="removeColumn"
                data-test-subj="discoverDocTable"
              ></doc-table>

              <div ng-if="rows.length == opts.sampleSize" class="dscTable__footer">
                <span
                  i18n-id="kbn.discover.howToSeeOtherMatchingDocumentsDescription"
                  i18n-default-message="These are the first {sampleSize} documents matching
                  your search, refine your search to see others. "
                  i18n-values="{
                    sampleSize: opts.sampleSize,
                  }"
                ></span>
                <a
                  kbn-accessible-click
                  ng-click="scrollToTop()"
                  id="discoverBottomMarker"
                  i18n-id="kbn.discover.backToTopLinkText"
                  i18n-default-message="Back to top."
                ></a>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>
</discover-app>
